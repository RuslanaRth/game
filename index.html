<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Ken — test levels</title>
<style>
  html,body {height:100%; margin:0; background:#000;}
  #gameCanvas {display:block; margin:0 auto; background:#222;}
  #overlay {position:fixed; left:10px; top:10px; color:#fff; font-family: monospace; background:rgba(0,0,0,0.6); padding:6px; border-radius:6px;}
  #status {position:fixed; right:10px; top:10px; color:#fff; font-family:monospace; background:rgba(0,100,0,0.6); padding:6px; border-radius:6px;}
</style>
</head>
<body>
<canvas id="gameCanvas" width="900" height="500"></canvas>
<div id="overlay">Загрузка ресурсов...</div>
<div id="status">Проверка...</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const statusBox = document.getElementById('status');

const IMAGES = {
  back1: 'back1.jpg',
  back2: 'back2.jpg',
  idle: 'idle.png',
  idle2: 'idle2.png',
  walk1: 'walk1.png',
  walk2: 'walk2.png',
  punch: 'punch.png',
  mushidle1: 'mushidle1.png',
  mushidle2: 'mushidle2.png',
  mushpunch: 'mushpunch.png',
  mushdeath: 'mushdeath.png'
};

let images = {};
let loadedCount = 0;
let totalCount = Object.keys(IMAGES).length;

function loadImage(key, src) {
  return new Promise(resolve => {
    const img = new Image();
    let loaded = false;
    
    // Таймаут 3 секунды
    const timeout = setTimeout(() => {
      if (!loaded) {
        images[key] = null;
        loadedCount++;
        statusBox.style.background = 'rgba(128,0,0,0.6)';
        statusBox.innerHTML = 'Timeout: ${src}';
        loaded = true;
        resolve();
      }
    }, 3000);

    img.onload = () => { 
      clearTimeout(timeout);
      if (!loaded) {
        images[key] = img;
        loadedCount++;
        updateStatus();
        loaded = true;
        resolve();
      }
    };
    
    img.onerror = () => {
      clearTimeout(timeout);
      if (!loaded) {
        images[key] = null;
        loadedCount++;
        statusBox.style.background = 'rgba(128,0,0,0.6)';
        statusBox.innerHTML = ОШИБКА!<br>Не найден: ${src};
        loaded = true;
        resolve();
      }
    };
    
    img.src = src;
  });
}

function updateStatus() {
  statusBox.innerHTML = Загружено:<br>${loadedCount}/${totalCount};
  if (loadedCount === totalCount) {
    statusBox.style.background = 'rgba(0,100,0,0.6)';
    overlay.textContent = 'Загрузка завершена!';
  }
}

async function preloadAll() {
  overlay.textContent = 'Загружаю ресурсы...';
  const promises = Object.entries(IMAGES).map(([k,s]) => loadImage(k,s));
  await Promise.all(promises);
  overlay.textContent = 'Проверка завершена!';
}

function gameLoop() {
  ctx.fillStyle = '#224466';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  ctx.fillStyle = '#ffffff';
  ctx.font = '16px Arial';
  ctx.fillText(Загружено: ${loadedCount}/${totalCount}, 20, 40);
  
  if (loadedCount === totalCount) {
    ctx.fillStyle = '#00ff00';
    ctx.fillText('ВСЕ ФАЙЛЫ ПРОВЕРЕНЫ!', 20, 70);
    ctx.fillStyle = '#ffff00';
    ctx.fillText('Смотрите статус справа →', 20, 100);
  }
  
  requestAnimationFrame(gameLoop);
}

// Запускаем
preloadAll();
gameLoop();
</script>
</body>
</html>


