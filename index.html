<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ken Game</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; margin: 0 auto; background: black; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="450"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let keys = {};
let currentPage = 1;

// фон
const backgrounds = {
  1: loadImage("back1.jpg"),
  2: loadImage("back2.jpg"),
};

// Кенчик
const ken = {
  x: 100, y: 320, width: 80, height: 120,
  frame: 0, animTimer: 0,
  idle: [loadImage("stand.png"), loadImage("stand2.png")],
  walk: [loadImage("walk1.png"), loadImage("walk2.png")],
  punch: [loadImage("punch.png")],
  action: "idle"
};

// Злодей
const mush = {
  x: 500, y: 330, width: 80, height: 120,
  hp: 3, alive: true,
  frame: 0, animTimer: 0,
  idle: [loadImage("mushidle1.png"), loadImage("mushidle2.png")],
  punch: [loadImage("mushpunch.png")],
  death: [loadImage("mushdeath.png")],
  action: "idle"
};

function loadImage(src) {
  const img = new Image();
  img.src = src;
  return img;
}

// управление
window.addEventListener("keydown", e => { keys[e.key] = true; });
window.addEventListener("keyup", e => { keys[e.key] = false; });

function update() {
  ken.action = "idle";

  if (keys["ArrowRight"]) {
    ken.x += 4;
    ken.action = "walk";
  }
  if (keys["ArrowLeft"]) {
    ken.x -= 4;
    ken.action = "walk";
  }
  if (keys[" "]) {
    ken.action = "punch";
    if (currentPage === 2 && mush.alive &&
        ken.x + ken.width > mush.x && ken.x < mush.x + mush.width) {
      mush.hp -= 1;
      mush.action = "punch";
      if (mush.hp <= 0) {
        mush.alive = false;
        mush.action = "death";
      }
    }
  }

  // переход на 2-ю страницу
  if (currentPage === 1 && ken.x > canvas.width) {
    currentPage = 2;
    ken.x = 50; // возвращаем в начало экрана
  }
}

function drawCharacter(char) {
  let frames;
  if (char.action === "walk") frames = char.walk;
  else if (char.action === "punch") frames = char.punch;
  else if (char.action === "death") frames = char.death;
  else frames = char.idle;

  char.animTimer++;
  if (char.animTimer > 15) {
    char.animTimer = 0;
    char.frame = (char.frame + 1) % frames.length;
  }
  ctx.drawImage(frames[char.frame], char.x, char.y, char.width, char.height);
}

function gameLoop() {
  update();
  ctx.drawImage(backgrounds[currentPage], 0, 0, canvas.width, canvas.height);
  drawCharacter(ken);
  if (currentPage === 2 && mush.alive) {
    drawCharacter(mush);
  }
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
